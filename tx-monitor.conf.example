#================================================================
# 超流量保护系统 - 配置文件
# Traffic Limit Protection System - Configuration
# Version: 2.0.0
#================================================================

#================================================================
# 基础配置
#================================================================

# 监控的网卡名称（必需）
# 使用 'ip link' 或 'ifconfig' 查看可用网卡
INTERFACE="eth0"

# 月度流量阈值（MB，必需）
# 示例: 30000 = 30GB, 50000 = 50GB
THRESHOLD_MB=30000

# 检查间隔（分钟，默认：10）
# 建议: 5-15 分钟
CHECK_INTERVAL=10

#================================================================
# 响应阈值配置
#================================================================

# 警告等级1（默认：80%）- 记录日志 + 可选通知
WARNING_LEVEL_1=80

# 警告等级2（默认：90%）- 软阻断触发点
WARNING_LEVEL_2=90

# 警告等级3（默认：95%）- 硬阻断触发点
WARNING_LEVEL_3=95

# 临界等级（默认：100%）- 达到或超过阈值
CRITICAL_LEVEL=100

#================================================================
# 响应动作配置
#================================================================

# 90% 时的动作
# 选项: block_ports (软阻断), alert (仅告警)
ACTION_AT_90="block_ports"

# 95% 时的动作
# 选项: block_all (硬阻断-阻断所有流量), disable_interface (硬阻断-禁用网卡), alert (仅告警)
ACTION_AT_95="block_all"

# 100% 时的动作
# 选项: shutdown (关机), alert (仅告警)
# 警告: shutdown 会立即关闭服务器！
ACTION_AT_100="alert"

#================================================================
# 端口白名单/黑名单
#================================================================

# SSH 端口列表（软阻断和硬阻断时保留，逗号分隔）
# 默认: 22
# 如果使用了非标准 SSH 端口，请在此添加
SSH_PORTS="22"

# 白名单端口（软阻断时保留，逗号分隔）
# 常用端口: 22=SSH, 443=HTTPS, 80=HTTP, 53=DNS
WHITELIST_PORTS="22,443"

# 黑名单端口（软阻断时优先阻断，逗号分隔）
# 常见高流量端口: 80=HTTP, 8080=HTTP-Alt, 3000=开发服务器
BLOCK_PORTS="80,8080,3000,8000"

# 白名单 IP（软阻断时保留访问，逗号分隔）
# 示例: 管理员IP、监控服务器IP
WHITELIST_IPS=""

#================================================================
# 通知配置
#================================================================

# 启用通知（true/false）
ENABLE_NOTIFICATIONS=true

# Webhook 类型
# 选项: generic, slack, discord, telegram
WEBHOOK_TYPE="generic"

# Webhook URL（可选）
# Generic: 自定义 webhook 端点
# Slack: https://hooks.slack.com/services/YOUR/WEBHOOK/URL
# Discord: https://discord.com/api/webhooks/YOUR/WEBHOOK/URL
# Telegram: https://api.telegram.org/botYOUR_BOT_TOKEN/sendMessage
WEBHOOK_URL=""

# Telegram 聊天 ID（仅 Telegram 需要）
TELEGRAM_CHAT_ID=""

# 邮件通知地址（可选，需要配置 mail 命令）
NOTIFICATION_EMAIL=""

#================================================================
# 日志配置
#================================================================

# 日志格式
# 选项: text (传统文本), json (结构化JSON)
LOG_FORMAT="text"

# 最大日志大小（MB，达到后自动轮转）
MAX_LOG_SIZE_MB=100

#================================================================
# 高级配置
#================================================================

# 冷却时间（分钟，默认：30）
# 执行阻断动作后，在此时间内不会重复执行相同动作
COOLDOWN_MINUTES=30

# 防火墙链名称（默认：TX_MONITOR_BLOCK）
# 通常不需要修改
IPTABLES_CHAIN="TX_MONITOR_BLOCK"

#================================================================
# 配置模板预设
#================================================================
# 
# 低流量模板 (10GB):
#   THRESHOLD_MB=10000
#   WARNING_LEVEL_1=80
#   WARNING_LEVEL_2=90
#   WARNING_LEVEL_3=95
#   适用: 个人博客、展示站点
#
# 均衡模板 (50GB):
#   THRESHOLD_MB=50000
#   WARNING_LEVEL_1=80
#   WARNING_LEVEL_2=90
#   WARNING_LEVEL_3=95
#   适用: 小型网站、API 服务
#
# 高流量模板 (100GB):
#   THRESHOLD_MB=100000
#   WARNING_LEVEL_1=85
#   WARNING_LEVEL_2=92
#   WARNING_LEVEL_3=97
#   适用: 业务服务器、视频站点
#
#================================================================

#================================================================
# 配置验证建议
#================================================================
#
# 安装后验证:
#   1. tx-ctl doctor           - 运行健康检查
#   2. tx-ctl test             - 测试当前配置
#   3. tx-ctl force-check --dry-run  - 模拟运行
#   4. tx-ctl status           - 查看状态
#
# 快速设置阈值:
#   tx-ctl set-threshold 30000        - 设置为 30GB
#   tx-ctl set-threshold balanced     - 使用均衡模板
#
#================================================================
